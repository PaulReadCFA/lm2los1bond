<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bond Valuation Calculator | CFA Institute</title>
  <meta name="description" content="Interactive bond valuation calculator demonstrating present value calculations for coupon bonds">
  
  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
  
  <!-- Chart.js for visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <!-- Skip Links for Accessibility -->
    <a href="#calculator" class="skip-link">Skip to calculator</a>
    <a href="#data-table" class="skip-link">Skip to data table</a>
    <main class="content">
      <!-- Card 1: Equation -->
<section id="equation-card" class="card">
  <h4 class="card-title">Bond Valuation Equation</h4>
  <p class="equation-intro">
    Equation 6 shows the price of a coupon bond expressed as:
  </p>

  <div class="equation-container" aria-describedby="equation-description">
    <!-- MathML version -->
    <div id="mathml-equation">
      <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
        <mrow>
          <msub>
            <mi mathcolor="#ea792d">PV</mi>
            <mtext mathcolor="#ea792d">coupon bond</mtext>
          </msub>
          <mo>=</mo>
<mfrac linethickness="1.2px">
  <mi mathvariant="bold" mathcolor="#3369FF">PMT</mi>
  <mrow class="denominator-r">
    <mi mathcolor="#7a46ff">r</mi>
  </mrow>
</mfrac>

          <mo>×</mo>
          <mrow>
            <mo>[</mo>
            <mn>1</mn>
            <mo>−</mo>
            <mfrac>
              <mn>1</mn>
              <msup>
                <mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi mathcolor="#7a46ff">r</mi><mo>)</mo></mrow>
                <mi>T</mi>
              </msup>
            </mfrac>
            <mo>]</mo>
          </mrow>
          <mo>+</mo>
          <mfrac>
            <mi mathcolor="#32959a" mathvariant="bold">FV</mi>
            <msup>
              <mrow><mo>(</mo><mn>1</mn><mo>+</mo><mi mathcolor="#7a46ff">r</mi><mo>)</mo></mrow>
              <mi>T</mi>
            </msup>
          </mfrac>
        </mrow>
      </math>
    </div>

    <!-- HTML fallback -->
    <div id="html-equation" hidden>
      <span class="bold" style="color:#ea792d;">PV<sub>coupon bond</sub></span> =
      <span style="color:#3369FF;">PMT</span>/<span style="color:#7a46ff;">r</span>
      × [1 − 1/(1 + <span style="color:#7a46ff;">r</span>)<sup>T</sup>] +
      <span style="color:#49b2b8;">FV</span>/(1 + <span style="color:#7a46ff;">r</span>)<sup>T</sup>
    </div>
  </div>
</section>




      <!-- Cards 2 & 3: Results and Visualizer (side by side on desktop) -->
      <div class="grid-container">
        <!-- Card 2: Results & Analysis -->
        <div class="grid-item-left">
          <section class="card" id="results-card">
            <h4 class="card-title">Results and Analysis</h4>
            <div class="card-content">
              <div id="results-content">
                <!-- Populated by JavaScript -->
              </div>
            </div>
          </section>
        </div>

        <!-- Card 3: Visualizer -->
        <div class="grid-item-right">
          <section class="card" id="data-table">
            <h4 class="card-title">Bond Cash Flows</h4>
            <div class="card-content">
              <!-- View toggle buttons -->
              <div class="view-controls">
                <div class="legend" id="chart-legend">
                  <span class="legend-item">
                    <span class="legend-color" style="background-color: #f2af81; border: 1px solid #333;"></span>
                    Initial purchase (solid)
                  </span>
                  <span class="legend-item">
                    <span class="legend-color" style="background-color: #3369FF; border: 1px solid #333;"></span>
                    Coupon payment (solid)
                  </span>
                  <span class="legend-item">
                    <span class="legend-color" style="background-color: #49b2b8; border: 1px solid #333;"></span>
                    Principal repayment (solid)
                  </span>
                </div>
                
                <div class="button-group" role="group" aria-label="View mode">
                  <button id="chart-view-btn" class="toggle-btn active" aria-pressed="true">
                    Show Chart
                  </button>
                  <button id="table-view-btn" class="toggle-btn" aria-pressed="false">
                    Show Table
                  </button>
                </div>
              </div>

              <!-- Screen reader announcement for view changes -->
              <div class="sr-only" aria-live="polite" aria-atomic="true" id="view-announcement"></div>

              <!-- Hidden chart description -->
              <div class="sr-only" id="bond-chart-desc">
                <h5 id="bond-chart-title">Bond cash flows</h5>
                <p>Stacked bars display coupon payments and the final principal repayment over time. 
                   The initial purchase appears as a negative bar at period 0. 
                   Different borders help distinguish between payment types.</p>
              </div>

              <!-- Chart container -->
              <div id="chart-container" class="chart-wrapper" 
                   role="img" 
                   aria-labelledby="bond-chart-title" 
                   aria-describedby="bond-chart-desc"
                   tabindex="0">
                <canvas id="bond-chart"></canvas>
              </div>

              <!-- Table container -->
              <div id="table-container" class="table-wrapper" style="display: none;">
                <table id="cash-flow-table" class="data-table" tabindex="0">
                  <!-- Populated by JavaScript -->
                </table>
                <p id="table-note" class="table-note">
                  Note: Values in parentheses indicate negative cash flows (outflows).
                </p>
              </div>
            </div>
          </section>
        </div>
      </div>

      <!-- Card 4: Calculator -->
      <section class="card" id="calculator">
        <h4 class="card-title">Bond Cash Flow Calculator</h4>
        <div class="card-content">
          <!-- Static info row -->
          <div class="info-box">
            <div class="info-item">
              <span class="info-label">Face value:</span>
              <span class="info-value">$100.00</span>
            </div>
            <div class="info-item">
              <span class="info-label">Payment frequency:</span>
              <span class="info-value">Semi-annual</span>
            </div>
          </div>

          <!-- Required fields indicator -->
          

          <!-- Input controls -->
          <div class="input-section">
            <p class="sr-only" id="inputHelp">
              Enter values and the calculator updates results and the chart automatically.
            </p>

            <div class="input-group-inline">
  <div class="input-inline">
  <label for="coupon-rate" class="input-label-inline">
    Coupon rate (0–10):
  </label>
  <div class="input-with-suffix-inline">
    <input 
      type="number" 
      id="coupon-rate" 
      class="input-field-inline"
      min="0" max="10" step="0.1" value="8.6">
    <span class="input-suffix-inline">%</span>
  </div>
</div>

<div class="input-inline">
  <label for="ytm" class="input-label-inline">
    Yield-to-maturity (0–10):
  </label>
  <div class="input-with-suffix-inline">
    <input 
      type="number" 
      id="ytm" 
      class="input-field-inline"
      min="0" max="10" step="0.1" value="6.5">
    <span class="input-suffix-inline">%</span>
  </div>
</div>

<div class="input-inline">
  <label for="years" class="input-label-inline">
    Years-to-maturity (1–5):
  </label>
  <div class="input-with-suffix-inline">
    <input 
      type="number" 
      id="years" 
      class="input-field-inline"
      min="1" max="5" step="0.5" value="5">
    <span class="input-suffix-inline" aria-hidden="true">&nbsp;</span>
  </div>
</div>


</div>


            <!-- Validation summary -->
            <div id="validation-summary" class="validation-summary" role="alert" style="display: none;">
              <div class="validation-title">Please correct the following:</div>
              <ul id="validation-list"></ul>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- JavaScript Modules -->
  <script type="module" src="calculator.js"></script>
  <script>
  // Simple MathML support check
  const supportsMathML = CSS.supports('math-style: normal');

  if (!supportsMathML) {
    // Hide MathML, show fallback
    const mathml = document.getElementById('mathml-equation');
    const fallback = document.getElementById('html-equation');
    if (mathml && fallback) {
      mathml.hidden = true;
      fallback.hidden = false;
    }
  }
</script>

</body>
</html>
